<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>LawCards</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#f5f7fb;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.card-container{perspective:1000px}
.card{
  width:320px;height:190px;
  position:relative;
  transform-style:preserve-3d;
  transition:transform .6s;
  cursor:pointer;
}
.card.is-flipped{transform:rotateY(180deg)}
.card-face{
  position:absolute;width:100%;height:100%;
  background:#fff;border-radius:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
  display:flex;align-items:center;justify-content:center;
  padding:20px;text-align:center;font-size:18px;
  backface-visibility:hidden;
}
.card-back{transform:rotateY(180deg)}

.controls,.nav,.filters{
  margin-top:14px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
button{
  border:none;border-radius:12px;
  padding:10px 14px;font-size:14px;
  cursor:pointer;
}
.perfect{background:#4CAF50;color:#fff}
.again{background:#FFC107}
.bad{background:#F44336;color:#fff}
.delete{background:#9e9e9e;color:#fff}
.nav button{background:#e0e0e0}
select,input{padding:6px;border-radius:8px}
</style>
</head>

<body>

<div class="filters">
  <select id="categoryFilter">
    <option value="ALL">å…¨ç§‘ç›®</option>
    <option>æ†²æ³•</option>
    <option>åˆ‘æ³•</option>
    <option>åˆ‘äº‹è¨´è¨Ÿæ³•</option>
    <option>æ°‘æ³•</option>
    <option>æ°‘äº‹è¨´è¨Ÿæ³•</option>
    <option>è¡Œæ”¿æ³•</option>
    <option>å•†æ³•</option>
    <option>é¸æŠç§‘ç›®</option>
  </select>

  <select id="statusFilter">
    <option value="ALL">å…¨ç¿’ç†Ÿåº¦</option>
    <option>æœªå­¦ç¿’</option>
    <option>å®Œç’§</option>
    <option>ã‚‚ã†1å›</option>
    <option>å…¨ç„¶ãƒ€ãƒ¡</option>
  </select>
</div>

<div class="card-container">
  <div class="card" id="card">
    <div class="card-face" id="front"></div>
    <div class="card-face card-back" id="back"></div>
  </div>
</div>

<div class="controls">
  <button class="perfect">å®Œç’§</button>
  <button class="again">ã‚‚ã†1å›</button>
  <button class="bad">å…¨ç„¶ãƒ€ãƒ¡</button>
  <button class="delete">ğŸ—‘</button>
</div>

<div class="nav">
  <button id="prev">â†</button>
  <button id="next">â†’</button>
</div>

<input type="file" id="csvInput" accept=".csv">

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let allCards=[];
let filtered=[];
let index=0;

/* ===== DOM ===== */
const card=document.getElementById("card");
const front=document.getElementById("front");
const back=document.getElementById("back");
const catFilter=document.getElementById("categoryFilter");
const statusFilter=document.getElementById("statusFilter");

/* ===== åˆæœŸ ===== */
function today(){return new Date().toISOString().slice(0,10)}

function logStudy(){
  const key="log_"+today();
  const count=parseInt(localStorage.getItem(key)||0)+1;
  localStorage.setItem(key,count);
}

/* ===== è¡¨ç¤º ===== */
function applyFilter(){
  filtered=allCards.filter(c=>{
    return (catFilter.value==="ALL"||c.category===catFilter.value)
    &&(statusFilter.value==="ALL"||c.status===statusFilter.value);
  });
  index=0;
  render();
}

function render(){
  if(filtered.length===0){
    front.textContent="ã‚«ãƒ¼ãƒ‰ãªã—";
    back.textContent="";
    return;
  }
  card.classList.remove("is-flipped");
  front.textContent=filtered[index].front;
  back.textContent=filtered[index].back;
}

card.onclick=()=>card.classList.toggle("is-flipped");

/* ===== ç¿’ç†Ÿåº¦ ===== */
function setStatus(s){
  filtered[index].status=s;
  logStudy();
  render();
}
document.querySelector(".perfect").onclick=()=>setStatus("å®Œç’§");
document.querySelector(".again").onclick=()=>setStatus("ã‚‚ã†1å›");
document.querySelector(".bad").onclick=()=>setStatus("å…¨ç„¶ãƒ€ãƒ¡");

/* ===== å‰Šé™¤ ===== */
document.querySelector(".delete").onclick=()=>{
  if(!filtered.length)return;
  allCards=allCards.filter(c=>c!==filtered[index]);
  applyFilter();
};

/* ===== ç§»å‹• ===== */
document.getElementById("next").onclick=()=>{
  if(index<filtered.length-1){index++;render();}
};
document.getElementById("prev").onclick=()=>{
  if(index>0){index--;render();}
};

/* ===== CSV =====
è¡¨,è£,ã‚«ãƒ†ã‚´ãƒª
*/
document.getElementById("csvInput").onchange=e=>{
  const f=e.target.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    const lines=r.result.split("\n");
    allCards=lines.slice(1).map(l=>{
      const [f,b,c]=l.split(",");
      return{front:f,back:b,category:c||"æ†²æ³•",status:"æœªå­¦ç¿’"};
    });
    applyFilter();
  };
  r.readAsText(f);
};

catFilter.onchange=statusFilter.onchange=applyFilter;
</script>

</body>
</html>
