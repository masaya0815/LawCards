<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>LawCards</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#f4f6fb;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  height:100vh;
}

header{
  padding:16px;
  font-weight:700;
  font-size:20px;
}

#cardWrap{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  width:100%;
  overflow:hidden;
}

.card{
  width:85%;
  max-width:420px;
  height:260px;
  background:white;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  font-weight:600;
  padding:20px;
  text-align:center;
  cursor:pointer;
  user-select:none;
  transition:transform .4s,opacity .4s;
  transform-style:preserve-3d;
}

.card.is-flipped{
  transform:rotateY(180deg);
}

.face{
  position:absolute;
  backface-visibility:hidden;
}

.back{
  transform:rotateY(180deg);
}

/* ===== スライド ===== */
.slide-left{ animation:slideLeft .25s forwards }
.slide-right{ animation:slideRight .25s forwards }

@keyframes slideLeft{
  to{ transform:translateX(-120%); opacity:0 }
}
@keyframes slideRight{
  to{ transform:translateX(120%); opacity:0 }
}

.enter-from-right{
  transform:translateX(120%);
  opacity:0;
}
.enter-from-left{
  transform:translateX(-120%);
  opacity:0;
}

footer{
  width:100%;
  padding:12px;
  display:flex;
  justify-content:center;
  gap:16px;
}

button{
  border:none;
  padding:12px 18px;
  border-radius:14px;
  background:#4f6ef7;
  color:white;
  font-size:16px;
  font-weight:600;
}

input[type=file]{
  margin-bottom:10px;
}
</style>
</head>

<body>

<header>LawCards</header>

<input type="file" id="csv">

<div id="cardWrap">
  <div class="card" id="card">
    <div class="face front" id="front"></div>
    <div class="face back" id="back"></div>
  </div>
</div>

<footer>
  <button id="prev">◀</button>
  <button id="next">▶</button>
</footer>

<script>
let cards = JSON.parse(localStorage.getItem("cards")||"[]");
let index = 0;
let flipped = false;

const card = document.getElementById("card");
const front = document.getElementById("front");
const back = document.getElementById("back");

function render(){
  if(cards.length===0){
    front.textContent="CSVを読み込んでください";
    back.textContent="";
    return;
  }
  front.textContent=cards[index].front;
  back.textContent=cards[index].back;
}

render();

/* ===== フリップ ===== */
card.onclick=()=>{
  card.classList.toggle("is-flipped");
  flipped=!flipped;
};

/* ===== スライド ===== */
function slide(next){
  if(next && index>=cards.length-1) return;
  if(!next && index<=0) return;

  card.classList.remove("is-flipped");
  flipped=false;

  card.classList.add(next?"slide-left":"slide-right");

  setTimeout(()=>{
    card.className="card";
    index += next?1:-1;
    card.classList.add(next?"enter-from-right":"enter-from-left");
    render();
    requestAnimationFrame(()=>card.className="card");
  },250);
}

document.getElementById("next").onclick=()=>slide(true);
document.getElementById("prev").onclick=()=>slide(false);

/* ===== スワイプ ===== */
let sx=0;
card.addEventListener("touchstart",e=>sx=e.touches[0].clientX);
card.addEventListener("touchend",e=>{
  const d=e.changedTouches[0].clientX-sx;
  if(Math.abs(d)<40)return;
  slide(d<0);
});

/* ===== CSV ===== */
document.getElementById("csv").onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{
    cards=r.result.split("\n").map(l=>{
      const [f,b]=l.split(",");
      return{front:f,back:b};
    });
    index=0;
    localStorage.setItem("cards",JSON.stringify(cards));
    render();
  };
  r.readAsText(e.target.files[0]);
};
</script>

</body>
</html>
